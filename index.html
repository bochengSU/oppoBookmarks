<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊàëÁöÑÊõ∏Á±§ (ÊúÄÁµÇÂäüËÉΩÁâà)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* Basic Reset & Font */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
        }
        /* Main Container for the Bookmarks */
        .bookmark-container {
            max-width: 900px;
            margin: 20px auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.2em;
            font-weight: 700;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        /* Styling for the main list and nested lists */
        .bookmark-list {
            list-style-type: none;
            padding-left: 0;
            margin: 0;
        }
        .bookmark-list ul {
            list-style-type: none;
            padding-left: 25px;
            margin: 5px 0;
        }
        /* Styling for each bookmark item */
        .bookmark-item {
            margin-bottom: 10px;
            position: relative;
        }
        /* Styling for folder (details/summary) */
        .bookmark-folder-details {
            margin-top: 15px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fcfcfc;
            overflow: hidden;
        }
        .bookmark-folder-details[open] > summary {
            background-color: #e8f0fe;
            border-bottom: 1px solid #d0d0d0;
        }
        .bookmark-folder-summary {
            font-weight: 700;
            cursor: pointer;
            padding: 12px 15px;
            background-color: #f0f8ff;
            color: #34495e;
            display: flex;
            align-items: center;
            user-select: none;
            transition: background-color 0.2s ease-in-out;
        }
        .bookmark-folder-summary:hover {
            background-color: #e8f0fe;
        }
        .bookmark-folder-summary h3 {
            margin: 0;
            font-size: 1.1em;
            display: inline-block;
            padding-left: 5px;
        }
        .bookmark-folder-details summary::-webkit-details-marker { display: none; }
        .bookmark-folder-details summary::before {
            content: "‚ñ∂";
            display: inline-block;
            margin-right: 10px;
            transition: transform 0.2s ease-in-out;
            font-size: 0.8em;
        }
        .bookmark-folder-details[open] summary::before { transform: rotate(90deg); }
        /* Styling for individual links */
        .bookmark-link {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            text-decoration: none;
            color: #555;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            border-bottom: 1px solid #f0f0f0;
        }
        .bookmark-item:hover .bookmark-link {
             background-color: #eef5ff;
             color: #007bff;
        }
        .bookmark-link:last-child { border-bottom: none; }
        /* Favicon styling */
        .bookmark-icon {
            width: 16px;
            height: 16px;
            margin-right: 10px;
            vertical-align: middle;
            border-radius: 3px;
            flex-shrink: 0;
        }
        /* Controls (edit/delete buttons) styling */
        .item-controls {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            padding-left: 10px;
        }
        .bookmark-item:hover .item-controls,
        .bookmark-folder-summary:hover .item-controls { opacity: 1; }
        .control-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 5px;
            border-radius: 4px;
            line-height: 1;
            color: #555;
        }
        .control-btn:hover { background-color: rgba(0, 0, 0, 0.1); color: #000; }
        /* Action buttons styling */
        .folder-actions {
            padding: 5px 15px 10px 40px;
            border-top: 1px solid #e0e0e0;
            background-color: #fdfdfd;
        }
        .add-btn {
            background-color: #e8f0fe;
            color: #34495e;
            border: 1px solid #d0d8e0;
            padding: 4px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-right: 10px;
        }
        .add-btn:hover { background-color: #dbe8fd; }
        .main-add-button-container { text-align: center; margin-bottom: 25px; }
        /* Drag & Drop styling */
        .draggable-item.dragging {
            opacity: 0.4;
            background: #cce5ff;
        }
        .drop-target-item {
            border: 2px dashed #007bff !important;
            background-color: #eef5ff !important;
        }
        #root-dropzone {
            height: 50px;
            margin-top: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            color: #aaa;
            border: 2px dashed transparent;
            transition: all 0.2s ease-in-out;
        }
        #root-dropzone.drop-target-root {
            border-color: #007bff;
            background-color: #eef5ff;
            color: #007bff;
        }
        /* Responsive adjustments */
        @media (max-width: 600px) {
            body { padding: 10px; }
            .bookmark-container { padding: 15px; border-radius: 8px; }
            h1 { font-size: 1.8em; }
            .bookmark-list ul { padding-left: 20px; }
            .item-controls { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="bookmark-container">
        <h1>ÊàëÁöÑÊõ∏Á±§</h1>
        <div class="main-add-button-container">
            <button id="add-main-folder-btn" class="add-btn">Ôºã Êñ∞Â¢û‰∏ªË≥áÊñôÂ§æ</button>
            <button id="add-main-link-btn" class="add-btn">Ôºã Êñ∞Â¢ûÊõ∏Á±§Âà∞‰∏ªÈ†Å</button>
        </div>
        <ul id="bookmark-list-root" class="bookmark-list"></ul>
        <div id="root-dropzone">ÊãñÊõ≥Âà∞Ê≠§ËôïÂèØÁßªËá≥ÊúÄÂ§ñÂ±§</div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const BOOKMARKS_STORAGE_KEY = 'myEditableBookmarks';
    const rootListElement = document.getElementById('bookmark-list-root');
    const addMainFolderBtn = document.getElementById('add-main-folder-btn');
    const addMainLinkBtn = document.getElementById('add-main-link-btn');
    const rootDropzone = document.getElementById('root-dropzone');
    let bookmarks = [];

    // --- ÂÆåÊï¥ÁöÑÂàùÂßãÊõ∏Á±§Ë≥áÊñô (Âæû indextest.html ÊèêÂèñ) ---
    const initialBookmarks = [
        {
            "type": "folder",
            "name": "Êõ∏Á±§Âàó",
            "isOpen": true,
            "children": [
                { "type": "link", "name": "Microsoft Office", "url": "https://www.office.com/?auth=2" },
                { "type": "link", "name": "eHRS(Á∑ö‰∏ä‰∫∫Ë≥á)", "url": "http://cshr.chainsea.com.tw/Ehrsnet/Account/Index#Home" },
                {
                    "type": "folder",
                    "name": "OPPO",
                    "isOpen": false,
                    "children": [
                        { "type": "link", "name": "Twilio", "url": "https://flex.twilio.com/lion-bloodhound-6675" },
                        { "type": "link", "name": "WCSM", "url": "https://service-sg.myoppo.com/login" },
                        { "type": "link", "name": "Áµ±‰∏ÄË™çË≠â‰∏≠ÂøÉ", "url": "https://sso.myoas.com/siam/login?service=https%3A%2F%2Fsso.myoas.com%2Fsiam%2Foauth2.0%2FcallbackAuthorize%3Foauth20_callbackUrl%3Dhttps%3A%2F%2Fgcsm-sg.oppoit.com%2Fportal%2Fapi%2Fv1%2Fsso%2Fcallback&oauth20_state=https%3A%2F%2Fgcsm-sg.oppoit.com%2Forder%2Forder-management%2Fafter-sales-order" },
                        { "type": "link", "name": "ÈªëË≤ìË≤®ÊÖã", "url": "https://www.t-cat.com.tw/inquire/trace.aspx" },
                        { "type": "link", "name": "Êô∫ÈΩí", "url": "https://chat-sg.oppo.com/console/home/myReception" },
                        { "type": "link", "name": "oppoÊñáÂ≠óÂÆ¢Êúç", "url": "https://cs.oppo-aed.tw/login#/login" },
                        { "type": "link", "name": "OPPOÈ´îÈ©óÂ∫ó", "url": "https://docs.google.com/spreadsheets/d/1CtwmIZublKb_yUYqgdLByM8ffwrYhBV9z1b931KY_2w/edit?copiedFromTrash#gid=1454694516" },
                        { "type": "link", "name": "OPPOË°®ÂñÆ(Ê®°ÊùøÁΩêÈ†≠)", "url": "https://docs.google.com/spreadsheets/d/1T8vT3XCIulq2vY8QjeIKN7PBsfOVLKxCEpYqeb6Q1rQ/edit#gid=1307372469" },
                        { "type": "link", "name": "OPPOÊ©üÂûãÊñô‰ª∂Ê∞∏Áº∫Ë°®", "url": "https://docs.google.com/spreadsheets/d/1DzbmFhv5GFf8-p5DkKlHimzvRou1LyLS/edit?gid=1640156935#gid=1640156935" },
                        { "type": "link", "name": "OPPOÊìç‰ΩúÁΩêÈ†≠", "url": "https://docs.google.com/spreadsheets/d/16aizSwEhaRzNbnq02eb2esDvsTtWHTgw/edit#gid=1738325245" },
                        { "type": "link", "name": "OPPOÊâãÊ©üÂàÜÊûêË°®", "url": "https://docs.google.com/spreadsheets/d/1ihphqb5kwbZ5VGPhvh5mdLl_OOp6OR1Z/edit#gid=948748319" },
                        { "type": "link", "name": "Airtable(‰ΩàÈÅîË≥áË®ä)", "url": "https://airtable.com/appo0Lgi88CH67Fko/tbldP4APTKOM2lWmx/viwb3JTf6h9erucdE?blocks=hide" },
                        { "type": "link", "name": "OPPO‰ΩàÈÅîonedrive(oppo@54386488)", "url": "https://oppomobile-my.sharepoint.com/:f:/g/personal/admin_oppo-aed_tw/EinDipPQbfVIiXo2l0gIpS0B8ks0d6He7zwUmoRaJngwVg" },
                        { "type": "link", "name": "OPPO‰ΩàÈÅî(ÂéüOnedriveÂÖßÂÆπ)", "url": "https://drive.google.com/drive/folders/11fljDcPvdGFY28f0DAlu0Rh1hz_MfjnL" },
                        { "type": "link", "name": "OPPOÂæåÊããÊ°à‰ª∂ - È¶ñÈ†Å", "url": "https://84459043.sharepoint.com/sites/OPPO-" },
                        { "type": "link", "name": "OPPO Life", "url": "https://app.oppo-aed.tw/admin" },
                        { "type": "link", "name": "CYBERBIZÂæåÂè∞ÁÆ°ÁêÜ", "url": "https://oppo.cyberbiz.co/user/sign_in" },
                        { "type": "link", "name": "OPPOÂÆòÁ∂≤", "url": "https://www.oppo.com/tw/" },
                        { "type": "link", "name": "OPPOÁ∂≤Ë∑ØÂïÜÂ∫ó", "url": "https://estore.oppo-aed.tw/?utm_campaign=estore&utm_medium=button&utm_source=officialweb" },
                        { "type": "link", "name": "OPPOÂÆòÁ∂≤(ÂÖ®ÁêÉ)", "url": "https://www.oppo.com/en/choose-site/" },
                        { "type": "link", "name": "HeyTapÂÆòÁ∂≤", "url": "https://brand.heytap.com/cn/business.html" },
                        { "type": "link", "name": "OPPOÂÆòÊñπÁ≤âÂ∞à", "url": "https://zh-tw.facebook.com/OPPOTaiwan/" },
                        { "type": "link", "name": "Á•ûÊèö‰øù‰ª£(Â∏≥/ÂØÜ54386488)", "url": "https://insurance.senyoung.com.tw/default.aspx" },
                        { "type": "link", "name": "Áî¢ÂìÅ‰øùÂõ∫", "url": "http://warranty-query.newboomgroup.tw:8012/manager/login" },
                        { "type": "link", "name": "Ë≤°ÊîøÈÉ®Á®ÖÁ±çË≥áÊñôÂÖ¨ÂºèÊü•Ë©¢(Ë¶ÜÊ†∏Áî®Êà∂Êèê‰æõÁöÑÁµ±Á∑®Êä¨È†≠)", "url": "https://www.etax.nat.gov.tw/etwmain/etw113w1/ban/query" },
                        { "type": "link", "name": "‰∏âÂ§ßÈõª‰ø° - Google Ë©¶ÁÆóË°®", "url": "https://docs.google.com/spreadsheets/d/16rPtb3sIXBZ92mK5Xdnskc39Cd9fUJe8a60i9nWhcZ8/edit#gid=0" },
                        { "type": "link", "name": "Âè∞ÁÅ£Â§ßÂì•Â§ßÊîØÊè¥VoLTE/VoWifiÊ©üÊ¨æË™™Êòé", "url": "https://www.taiwanmobile.com/csonline/service/ann/ann3_20160407_143146.html" },
                        { "type": "link", "name": "ÈÅ†ÂÇ≥ÊîØÊè¥VoLTE/VoWifiÊ©üÊ¨æË™™Êòé", "url": "https://www.fetnet.net/content/cbu/tw/help-center/detail.html?uuid=cab05b57-d6c7-42a7-a198-2571f60b4133&tagId=cbu:faq/charges/postpaid/VoLTEVoWiFi" },
                        { "type": "link", "name": "‰∏≠ËèØÈõª‰ø°ÊîØÊè¥VoLTE/VoWifiÊ©üÊ¨æË™™Êòé", "url": "https://www.cht.com.tw/home/consumer/mobservice/basic/744" },
                        { "type": "link", "name": "Âè∞ÁÅ£‰πãÊòüÊîØÊè¥VoLTE/VoWifiÊ©üÊ¨æË™™Êòé", "url": "https://www.tstartel.com/CWS/vas_VolteMobile.php" },
                        { "type": "link", "name": "Âá∫ÂúãÈ†ªÊÆµÁ¢∫Ë™ç", "url": "https://www.taiwanmobile.com/cs/public/query4GBandIndex.htm" },
                        { "type": "link", "name": "AIÂäüËÉΩÊìç‰ΩúÊñπÂºè", "url": "https://drive.google.com/drive/u/0/folders/1Ojv9Pm6fig6lk3NYN2VIz5Ta5SySI7Ae" }
                    ]
                }
            ]
        },
        {
            "type": "folder",
            "name": "realme",
            "isOpen": false,
            "children": [
                { "type": "link", "name": "Êñ∞ECP", "url": "https://cs-bpo01.qbicloud.com/ecp/" },
                { "type": "link", "name": "ECP", "url": "https://bpo.qbicloud.com/ecp/Qs.MainFrame.page" },
                { "type": "link", "name": "RCSM", "url": "https://rcsm-sg.realmeservice.com/#/login" },
                { "type": "link", "name": "R-Learning", "url": "https://oln-realme.myoppo.com/login.html" },
                { "type": "link", "name": "ÈªëË≤ì ‰ºÅÂÆ¢(Â∏≥5438648808/ÂØÜ54386488)", "url": "https://www.takkyubin.com.tw/YMTContract/aspx/Login.aspx" },
                { "type": "link", "name": "realmeÊñáÂ≠óÂÆ¢Êúç", "url": "https://cs.realme.com.tw/login" },
                { "type": "link", "name": "realmeÂïÜÂ∫óÂæåÂè∞ÁôªÂÖ•", "url": "https://auth.91app.com/identity/login?signin=4bdbf5c33f3c3ddd847b35755bd8e98c" },
                { "type": "link", "name": "realmeÂÖ®Áî¢ÂìÅÈÄöË∑ØÁôºË≤®Ë®äÊÅØ_2020", "url": "https://docs.google.com/spreadsheets/d/1HxXbATqpO1sRvOR3-JNxaUPg2RtT14cRgN1waEDgCtQ/edit#gid=0" },
                { "type": "link", "name": "realmeÂÖ®Áî¢ÂìÅÈÄöË∑ØÁôºË≤®Ë®äÊÅØ_2021", "url": "https://docs.google.com/spreadsheets/d/19cFZ0T_P3aeol3V4KyrCXpdl1CWJGIfjAYegXAw9mnU/edit#gid=0" },
                { "type": "link", "name": "realmeÂÖ®Áî¢ÂìÅÈÄöË∑ØÁôºË≤®Ë®äÊÅØ_2022", "url": "https://docs.google.com/spreadsheets/d/1SIFFEpyzJNg9xvvkOxxCITLTdidAdKNX4q-OOc2y7L4/edit#gid=0" },
                { "type": "link", "name": "realmeÂÆ¢ÊúçË°®ÂñÆ(Ê®°ÊùøÁΩêÈ†≠)", "url": "https://docs.google.com/spreadsheets/d/1T8vT3XCIulq2vY8QjeIKN7PBsfOVLKxCEpYqeb6Q1rQ/edit#gid=1580571186" },
                { "type": "link", "name": "realme‰ΩàÈÅîonedrive(oppo@54386488)", "url": "https://oppomobile-my.sharepoint.com/:f:/g/personal/admin_oppo-aed_tw/EinDipPQbfVIiXo2l0gIpS0B8ks0d6He7zwUmoRaJngwVg" },
                { "type": "link", "name": "realme‰ΩàÈÅî(ÂéüOnedriveÂÖßÂÆπ)", "url": "https://drive.google.com/drive/folders/11fljDcPvdGFY28f0DAlu0Rh1hz_MfjnL" },
                { "type": "link", "name": "realmeÂæåÊããÊ°à‰ª∂ - È¶ñÈ†Å", "url": "https://84459043.sharepoint.com/sites/OPPO-" },
                { "type": "link", "name": "realmeÂØ©‰ª∂ÂæåÂè∞", "url": "https://app.realme.com.tw/admin" },
                { "type": "link", "name": "realmeÂÆòÁ∂≤", "url": "https://www.realme.com/tw/" },
                { "type": "link", "name": "realmeÁ∂≤Ë∑ØÂïÜÂ∫ó", "url": "https://www.realme.tw/?utm_source=officialsite&utm_medium=navigation&utm_campaign=realmestore" },
                { "type": "link", "name": "realmeÂÆòÊñπÁ≤âÂ∞à", "url": "https://zh-tw.facebook.com/realmeTaiwan/" },
                { "type": "link", "name": "realme TVËÅØÂº∑ÂúãÈöõÈõÜÂúò ÈÄöÈÅîÊô∫ËÉΩÈÅãÁ±å", "url": "http://www.logistics-syn.com/index.html" },
                { "type": "link", "name": "realmeÁ∂≠‰øÆÈÄ≤Â∫¶Êü•Ë©¢", "url": "https://los.synnex-grp.com/LOS_V/views/rpm/spqi/spqi_main?OA=OA" },
                { "type": "link", "name": "realmeÊúçÂãôÈÄ≤Â∫¶Êü•Ë©¢", "url": "http://tpl.synnex-grp.com/TPL/queryShipStatus.jsp" },
                { "type": "link", "name": "Áî¢ÂìÅ‰øùÂõ∫", "url": "http://warranty-query.newboomgroup.tw:8012/manager/login" },
                { "type": "link", "name": "Ë≤°ÊîøÈÉ®Á®ÖÁ±çË≥áÊñôÂÖ¨ÂºèÊü•Ë©¢(Ë¶ÜÊ†∏Áî®Êà∂Êèê‰æõÁöÑÁµ±Á∑®Êä¨È†≠)", "url": "https://www.etax.nat.gov.tw/etwmain/etw113w1/ban/query" },
                { "type": "link", "name": "91APP(realmeÁ∂≤Ë∑ØÂïÜÂ∫óÔºåË©¢ÂïèÈóúÊñºÁ≥ªÁµ±Êìç‰Ωú„ÄÅË®ÇÂñÆÈÄÄÊ¨æ„ÄÅÁôºÁ•®/Âà∑Âç°Á≠âÁñëÈõ£ÈõúÁóá)", "url": "https://www.91app.com/contactus/" }
            ]
        }
    ];

    // ------------------- Ë≥áÊñôËôïÁêÜ -------------------
    function loadBookmarks() {
        try {
            const storedBookmarks = localStorage.getItem(BOOKMARKS_STORAGE_KEY);
            bookmarks = storedBookmarks ? JSON.parse(storedBookmarks) : initialBookmarks;
        } catch (e) {
            console.error("ÁÑ°Ê≥ïËºâÂÖ•Êõ∏Á±§:", e);
            bookmarks = initialBookmarks;
        }
    }
    function saveBookmarks() {
        localStorage.setItem(BOOKMARKS_STORAGE_KEY, JSON.stringify(bookmarks, null, 2));
    }
    function getFaviconUrl(url) {
        try {
            return `https://www.google.com/s2/favicons?sz=32&domain_url=${new URL(url).hostname}`;
        } catch (e) {
            return "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";
        }
    }

    // ------------------- Ê∏≤ÊüìÁï´Èù¢ -------------------
    function render() {
        rootListElement.innerHTML = '';
        renderNodes(bookmarks, rootListElement, []);
    }
    function renderNodes(nodes, parentElement, path) {
        nodes.forEach((node, index) => {
            const currentPath = [...path, index];
            const li = document.createElement('li');
            li.className = 'bookmark-item draggable-item';
            li.dataset.path = JSON.stringify(currentPath);
            li.draggable = true;
            if (node.type === 'folder') {
                li.appendChild(createFolderElement(node, currentPath));
            } else {
                li.appendChild(createLinkElement(node, currentPath));
            }
            parentElement.appendChild(li);
        });
    }
    function createFolderElement(node, path) {
        const details = document.createElement('details');
        details.className = 'bookmark-folder-details';
        details.open = node.isOpen;
        details.addEventListener('toggle', () => { node.isOpen = details.open; saveBookmarks(); });
        const summary = document.createElement('summary');
        summary.className = 'bookmark-folder-summary';
        const h3 = document.createElement('h3');
        h3.textContent = node.name;
        summary.append(h3, createControls(path));
        const ul = document.createElement('ul');
        ul.className = 'bookmark-list';
        if (node.children) renderNodes(node.children, ul, path);
        details.append(summary, ul, createFolderActions(path));
        return details;
    }
    function createLinkElement(node, path) {
        const a = document.createElement('a');
        a.href = node.url;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.className = 'bookmark-link';
        const img = document.createElement('img');
        img.src = getFaviconUrl(node.url);
        img.alt = '';
        img.className = 'bookmark-icon';
        img.onerror = function() { this.src = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="; };
        a.append(img, document.createTextNode(` ${node.name}`), createControls(path));
        return a;
    }
    function createControls(path) {
        const controlsDiv = document.createElement('div');
        controlsDiv.className = 'item-controls';
        const editBtn = document.createElement('button');
        editBtn.className = 'control-btn';
        editBtn.innerHTML = '‚úé';
        editBtn.title = 'Á∑®ËºØ';
        editBtn.addEventListener('click', e => { e.preventDefault(); e.stopPropagation(); editItem(path); });
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'control-btn';
        deleteBtn.innerHTML = 'üóëÔ∏è';
        deleteBtn.title = 'Âà™Èô§';
        deleteBtn.addEventListener('click', e => { e.preventDefault(); e.stopPropagation(); deleteItem(path); });
        controlsDiv.append(editBtn, deleteBtn);
        return controlsDiv;
    }
    function createFolderActions(path) {
        const folderActions = document.createElement('div');
        folderActions.className = 'folder-actions';
        const addLinkBtn = document.createElement('button');
        addLinkBtn.textContent = 'Ôºã Êñ∞Â¢ûÊõ∏Á±§';
        addLinkBtn.className = 'add-btn';
        addLinkBtn.addEventListener('click', e => { e.preventDefault(); addItem(path, 'link'); });
        const addSubFolderBtn = document.createElement('button');
        addSubFolderBtn.textContent = 'Ôºã Êñ∞Â¢ûÂ≠êË≥áÊñôÂ§æ';
        addSubFolderBtn.className = 'add-btn';
        addSubFolderBtn.addEventListener('click', e => { e.preventDefault(); addItem(path, 'folder'); });
        folderActions.append(addLinkBtn, addSubFolderBtn);
        return folderActions;
    }

    // ------------------- ‰∫íÂãïÈÇèËºØ -------------------
    function getNodeAndParentArray(path) {
        if (!path || path.length === 0) return { node: null, parentArray: bookmarks };
        let parentArray = bookmarks;
        for (let i = 0; i < path.length - 1; i++) {
            const parentNode = parentArray[path[i]];
            if (parentNode?.type === 'folder' && parentNode.children) {
                 parentArray = parentNode.children;
            } else { return { node: null, parentArray: null }; }
        }
        return { node: parentArray[path[path.length - 1]], parentArray };
    }
    function addItem(path, type) {
        const { node } = getNodeAndParentArray(path);
        const targetArray = path.length === 0 ? bookmarks : node.children;
        const name = prompt(`Ë´ãËº∏ÂÖ•Êñ∞ÁöÑ${type === 'link' ? 'Êõ∏Á±§' : 'Ë≥áÊñôÂ§æ'}ÂêçÁ®±Ôºö`);
        if (!name) return;
        if (type === 'link') {
            const url = prompt("Ë´ãËº∏ÂÖ•Á∂≤ÂùÄ (URL)Ôºö", "https://");
            if (!url) return;
            targetArray.push({ type: 'link', name, url });
        } else {
            targetArray.push({ type: 'folder', name, children: [], isOpen: true });
        }
        saveAndRerender();
    }
    function editItem(path) {
        const { node } = getNodeAndParentArray(path);
        if (!node) return;
        const newName = prompt("Ë´ãËº∏ÂÖ•Êñ∞ÁöÑÂêçÁ®±Ôºö", node.name);
        if (newName === null || newName === "") return;
        node.name = newName;
        if (node.type === 'link') {
            const newUrl = prompt("Ë´ãËº∏ÂÖ•Êñ∞ÁöÑÁ∂≤ÂùÄÔºö", node.url);
            if (newUrl !== null) node.url = newUrl;
        }
        saveAndRerender();
    }
    function deleteItem(path) {
        const { node, parentArray } = getNodeAndParentArray(path);
        if (!node || !parentArray) return;
        if (confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§ "${node.name}" ÂóéÔºü`)) {
            parentArray.splice(path[path.length - 1], 1);
            saveAndRerender();
        }
    }
    function saveAndRerender() {
        saveBookmarks();
        render();
    }

    // ------------------- ÊãñÊõ≥ÈÇèËºØ -------------------
    let draggedElementPath = null;
    document.addEventListener('dragstart', e => {
        const target = e.target.closest('.draggable-item');
        if (target) {
            draggedElementPath = JSON.parse(target.dataset.path);
            e.dataTransfer.effectAllowed = 'move';
            setTimeout(() => target.classList.add('dragging'), 0);
        }
    });
    document.addEventListener('dragover', e => {
        e.preventDefault();
        const dropTargetItem = e.target.closest('.bookmark-item, .bookmark-folder-summary');
        const dropTargetRoot = e.target.closest('#root-dropzone');
        
        document.querySelectorAll('.drop-target-item, .drop-target-root').forEach(el => 
            el.classList.remove('drop-target-item', 'drop-target-root')
        );

        if (dropTargetItem) {
            const targetElement = dropTargetItem.classList.contains('bookmark-folder-summary') ? 
                dropTargetItem.closest('.bookmark-folder-details') : 
                dropTargetItem;
            targetElement.classList.add('drop-target-item');
        } else if (dropTargetRoot) {
            dropTargetRoot.classList.add('drop-target-root');
        }
    });
    document.addEventListener('dragleave', e => {
        const target = e.target.closest('.drop-target-item, .drop-target-root');
        if (target && !target.contains(e.relatedTarget)) {
            target.classList.remove('drop-target-item', 'drop-target-root');
        }
    });
    document.addEventListener('dragend', () => {
        document.querySelectorAll('.dragging, .drop-target-item, .drop-target-root').forEach(el => 
            el.classList.remove('dragging', 'drop-target-item', 'drop-target-root')
        );
        draggedElementPath = null;
    });
    document.addEventListener('drop', e => {
        e.preventDefault();
        e.stopPropagation();
        if (!draggedElementPath) return;

        const dropTargetItem = e.target.closest('.bookmark-item, .bookmark-folder-summary');
        const dropTargetRoot = e.target.closest('#root-dropzone');
        let destinationPath;

        if (dropTargetRoot) {
            destinationPath = [bookmarks.length]; // ÊîæÂà∞Ê†πÁõÆÈåÑÊúÄÂæå
        } else if (dropTargetItem) {
            const destinationPathStr = dropTargetItem.closest('.draggable-item').dataset.path;
            const path = JSON.parse(destinationPathStr);
            const { node: destNode } = getNodeAndParentArray(path);
            if (destNode.type === 'folder' && JSON.stringify(draggedElementPath) !== destinationPathStr) {
                 destinationPath = [...path, destNode.children.length]; // ÊîæÂÖ•Ë≥áÊñôÂ§æ
            } else {
                 destinationPath = path; // ÊéíÂ∫è
            }
        } else {
            return;
        }
        
        moveNode(draggedElementPath, destinationPath);
        saveAndRerender();
    });
    
    function moveNode(sourcePath, destinationPath) {
        if (JSON.stringify(sourcePath) === JSON.stringify(destinationPath)) return;
        if (JSON.stringify(destinationPath).startsWith(JSON.stringify(sourcePath))) return;

        const { node: nodeToMove, parentArray: sourceParentArray } = getNodeAndParentArray(sourcePath);
        if (!nodeToMove) return;
        const sourceIndex = sourcePath[sourcePath.length - 1];
        sourceParentArray.splice(sourceIndex, 1);

        let adjustedDestPath = [...destinationPath];
        const sourceParentPath = sourcePath.slice(0, -1);
        const destParentPath = destinationPath.slice(0, -1);
        if (JSON.stringify(sourceParentPath) === JSON.stringify(destParentPath) && sourceIndex < destinationPath[destinationPath.length - 1]) {
            adjustedDestPath[adjustedDestPath.length - 1]--;
        }

        const { parentArray: destParentArray } = getNodeAndParentArray(adjustedDestPath);
        if (!destParentArray) return;
        const destIndex = adjustedDestPath[adjustedDestPath.length - 1];
        destParentArray.splice(destIndex, 0, nodeToMove);
    }
    
    // ------------------- ÂàùÂßãÂåñ -------------------
    addMainFolderBtn.addEventListener('click', () => addItem([], 'folder'));
    addMainLinkBtn.addEventListener('click', () => addItem([], 'link'));
    loadBookmarks();
    render();
});
</script>

</body>
</html>
